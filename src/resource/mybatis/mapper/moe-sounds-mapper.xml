<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.moesounds.dao.MoeSoundsDAO">

  <resultMap type="Page" id="PageMap">
      <id column="page_id" property="pageId"/>
      <association column="{pageId=page_id}" property="pageMedia" javaType="PageMedia" select="getPageMediaWithPageId" fetchType="lazy"/>
  </resultMap>


  <select id="getAllPages" resultMap="PageMap">
    SELECT
            page_id,
            page_name,
            css,
            click_count
    FROM
            moe_sounds.page
  </select>
  
  <select id="getPageMediaWithPageId" resultType="PageMedia">
    SELECT
            page_media_id,
            page_id,
            carousel_image_small,
            carousel_image_big,
            background_page,
            background_inner,
            sound_file
    FROM
            moe_sounds.page_media
            
    WHERE 
            page_id = #{pageId}
  
  </select>

  <insert id="insertPage" useGeneratedKeys="true" keyProperty="pageId">
    INSERT INTO moe_sounds.page (
        page_name,
        css
    )
    
    VALUES (
        #{pageName},
        #{css}
    )
  </insert>
  
  <insert id="insertPageMedia" useGeneratedKeys="true" keyProperty="pageMediaId">
    INSERT INTO moe_sounds.page_media (
        page_id,
        carousel_image_small,
        carousel_image_big,
        background_page,
        background_inner,
        sound_file
    )
    
    VALUES (
        #{pageId},
        #{carouselImageSmall},
        #{carouselImageBig},
        #{backgroundPage},
        #{backgroundInner},
        #{soundFile}
    )
  </insert>
  
  
</mapper>